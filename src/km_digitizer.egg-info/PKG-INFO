Metadata-Version: 2.4
Name: km-digitizer
Version: 0.1.0
Summary: Automated Kaplan-Meier curve digitization + synthetic benchmark
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.24
Requires-Dist: opencv-python>=4.8
Requires-Dist: matplotlib>=3.8
Requires-Dist: pillow>=10.0
Requires-Dist: pandas>=2.0
Requires-Dist: scipy>=1.10
Requires-Dist: pytesseract>=0.3.10

# km-digitizer

Automated digitization of Kaplan–Meier (KM) plots from images using classical CV:
- Detect plot panel (robust-ish to risk tables and legends)
- Segment curves by hue clusters (works best on colored curves)
- Trace each curve into (t_norm, survival) samples
- Evaluate with AE / IAE (area between curves)

Also includes a synthetic benchmark generator that renders KM-like plots with:
- 1–3 curves, overlap, grid/legend
- censor marks
- low resolution degradation (downsample/upsample, blur, JPEG)
- optional truncated y-axis (OCR calibration optional)

## Install

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
# or editable:
pip install -e .
```

## Digitize an image

```bash
python scripts/digitize_image.py \
  --image path/to/km.png \
  --outdir out_digitized \
  --debug
```

**Outputs:**
- `out_digitized/curves.csv` (one CSV containing all curves)
- `out_digitized/debug_overlay.png` if `--debug`

## Run synthetic benchmark

```bash
python scripts/run_benchmark.py \
  --outdir out_bench \
  --n_plots 200 \
  --seed 123
```

**Outputs:**
- images + ground truth curves in `out_bench/data/`
- summary metrics in `out_bench/summary.csv` and printed medians

Note: `pytesseract` also requires the system tesseract binary. If it's not available, the code will automatically skip OCR calibration.

## Notes / limitations

- Best performance is on plots where curves are **distinct colors**.
- Black-only multi-curve plots (distinguished only by linestyles) are not reliably separable with this baseline.
- Truncated y-axis calibration uses OCR if available; OCR can fail on noisy/low-res images (the benchmark includes this edge case).
